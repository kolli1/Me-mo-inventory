<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Mochi Inventory</title>
<style>
  body { font-family: Arial, sans-serif; background: #0f1724; color: #e6eef6; margin:0; padding:0; }
  .container { max-width: 600px; margin: auto; padding: 12px; }
  .card { background: #1e293b; padding: 20px; margin-bottom: 15px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
  h1, h2, h3 { margin: 6px 0; text-align: center; }
  input, select, button { font-family: inherit; padding: 10px; border-radius: 8px; margin-top: 6px; width: 100%; box-sizing: border-box; font-size: 16px; border: none; }
  select { background: #334155; color: #e6eef6; }
  input { background: #1e293b; color: #e6eef6; }
  .btn { cursor: pointer; margin-top: 10px; background: #2563eb; color: #fff; font-weight: bold; transition: 0.3s; }
  .btn:hover { background: #3b82f6; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  th, td { border: 1px solid #334155; padding: 8px; text-align: center; }
  th { background: #2563eb; }
  pre { white-space: pre-wrap; font-family: monospace; overflow-x: auto; padding:10px; background:#1e293b; border-radius:8px; }
  @media (min-width:600px){ input, select, button { width:auto; } }
</style>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body>
<div class="container">

<div class="card">
  <h1>üç® Mochi Inventory</h1>
  <label>Select Outlet:</label>
  <select id="outletSelect">
    <option value="">--Select--</option>
    <option value="FilmNagar">Film Nagar</option>
    <option value="Manikonda">Manikonda</option>
    <option value="Kondapur">Kondapur</option>
    <option value="Gachibowli">Gachibowli</option>
  </select>
  <button class="btn" id="loadBtn">Load Inventory</button>
</div>

<div class="card" id="inventoryCard" style="display:none">
  <h2>Inventory Management</h2>
  <table id="skuTable">
    <thead><tr><th>SKU</th><th>Opening</th><th>Closing</th></tr></thead>
    <tbody id="skuList"></tbody>
  </table>
  <button class="btn" id="saveInventory">Save Inventory</button>
</div>

<div class="card" id="reportCard" style="display:none">
  <h2>Reports</h2>
  <button class="btn" id="dailyReportBtn">Generate Daily Report</button>
  <button class="btn" id="salesReportBtn">Generate Sales Report</button>
  <button class="btn" id="weeklyReportBtn">Generate Weekly Summary</button>
  <pre id="reportOutput">Please generate a report...</pre>
  <button class="btn" id="shareWhatsApp">Share to WhatsApp</button>
  <button class="btn" id="shareImageBtn">Share Report as Image</button>
</div>

<script>
const DEFAULT_SKUS = ['Vanilla','Strawberry','Chocolate','Mango','Grape','Muskmelon','Coconut','Brownie','Paan'];
let skuData = [];
const OUTLET_KEYS = { FilmNagar: 'inventory_FilmNagar', Manikonda: 'inventory_Manikonda', Kondapur: 'inventory_Kondapur', Gachibowli: 'inventory_Gachibowli' };
const DAILY_KEYS = { FilmNagar: 'daily_FilmNagar', Manikonda: 'daily_Manikonda', Kondapur: 'daily_Kondapur', Gachibowli: 'daily_Gachibowli' };

function renderInventory(){
  let html='';
  skuData.forEach((sku,i)=>{
    html+=`<tr><td>${sku.name}</td><td><input type='number' id='open${i}' value='${sku.opening}' min='0'></td><td><input type='number' id='close${i}' value='${sku.closing}' min='0'></td></tr>`;
  });
  document.getElementById('skuList').innerHTML = html;
}

function loadInventory(){
  const outlet = document.getElementById('outletSelect').value;
  if(!outlet){ alert('Select an outlet'); return; }
  const saved = localStorage.getItem(OUTLET_KEYS[outlet]);
  skuData = saved ? JSON.parse(saved) : DEFAULT_SKUS.map(name=>({name, opening:0, closing:0}));
  renderInventory();
  document.getElementById('inventoryCard').style.display='block';
  document.getElementById('reportCard').style.display='block';
}

function saveInventory(){
  const outlet = document.getElementById('outletSelect').value;
  if(!outlet){ alert('Select an outlet'); return; }
  skuData.forEach((sku,i)=>{
    sku.opening = Math.max(0, +document.getElementById('open'+i).value);
    sku.closing = Math.max(0, +document.getElementById('close'+i).value);
  });
  localStorage.setItem(OUTLET_KEYS[outlet], JSON.stringify(skuData));
  const daily = JSON.parse(localStorage.getItem(DAILY_KEYS[outlet]) || '[]');
  daily.push({date: new Date().toISOString().slice(0,10), data: JSON.parse(JSON.stringify(skuData))});
  if(daily.length>7) daily.shift();
  localStorage.setItem(DAILY_KEYS[outlet], JSON.stringify(daily));
  alert('Inventory saved locally');
}

function formatTableReport(title, data){
  let text = title+'\n';
  text += 'SKU | Opening | Closing | Sold\n';
  text += '-------------------------------\n';
  data.forEach(sku=>{
    let sold=Math.max(0, sku.opening - sku.closing);
    text+=`${sku.name} | ${sku.opening} | ${sku.closing} | ${sold}\n`;
  });
  return text;
}

function generateDailyReport(){
  document.getElementById('reportOutput').textContent = formatTableReport('üìÖ Daily Inventory Report ‚Äì '+new Date().toLocaleDateString(), skuData);
}

function generateSalesReport(){
  let text='üìÖ Sales Report ‚Äì '+new Date().toLocaleDateString()+'\nSKU | Sold\n';
  text+='-------------------\n';
  skuData.forEach(sku=>{ text+=`${sku.name} | ${Math.max(0, sku.opening-sku.closing)}\n`; });
  document.getElementById('reportOutput').textContent=text;
}

function generateWeeklySummary(){
  const outlet = document.getElementById('outletSelect').value;
  if(!outlet){ alert('Select an outlet'); return; }
  const daily = JSON.parse(localStorage.getItem(DAILY_KEYS[outlet]) || '[]');
  if(daily.length===0){ document.getElementById('reportOutput').textContent='No weekly data available'; return; }
  let text = 'üìÖ Weekly Summary ‚Äì Last '+daily.length+' Days\nSKU | Total Sold\n';
  text+='-------------------\n';
  const totals = {};
  DEFAULT_SKUS.forEach(name=>totals[name]=0);
  daily.forEach(day=>{ day.data.forEach(sku=>{ totals[sku.name]+=Math.max(0, sku.opening-sku.closing); }); });
  DEFAULT_SKUS.forEach(name=>text+=`${name} | ${totals[name]}\n`);
  document.getElementById('reportOutput').textContent=text;
}

function shareWhatsApp(){
  const msg = document.getElementById('reportOutput').textContent;
  if(!msg){ alert('Generate a report first'); return; }
  window.open('https://wa.me/?text='+encodeURIComponent(msg));
}

function shareAsImage(){
  const reportDiv=document.getElementById('reportOutput');
  if(!reportDiv.textContent.trim()){ alert('Generate a report first'); return; }
  html2canvas(reportDiv, {backgroundColor:'#0f1724'}).then(canvas=>{
    const imgData=canvas.toDataURL('image/png');
    const imgWindow=window.open('', '_blank');
    imgWindow.document.write('<img src="'+imgData+'" style="width:100%;">');
  });
}

// Event Listeners
document.getElementById('loadBtn').onclick=loadInventory;
document.getElementById('saveInventory').onclick=saveInventory;
document.getElementById('dailyReportBtn').onclick=generateDailyReport;
document.getElementById('salesReportBtn').onclick=generateSalesReport;
document.getElementById('weeklyReportBtn').onclick=generateWeeklySummary;
document.getElementById('shareWhatsApp').onclick=shareWhatsApp;
document.getElementById('shareImageBtn').onclick=shareAsImage;
</script>

</div>
</body>
</html>
